## 🚀 Gemini CLI 实战教程笔记：终端机上的开源 AI 代理

```bash
无任何标记、无应用说明（只保留核心步骤）的 Gemini CLI 教程笔记
```

Gemini CLI（Command Line Interface）是 Google 推出的一款**开源 AI Agent（代理）**，旨在将 Gemini 大模型的能力直接引入终端机（Terminal）环境。

### 一、Gemini CLI 核心优势与功能概览

| 核心特性 | 描述 |
| :--- | :--- |
| **强大模型** | 免费接入 Google 最强的 **Gemini 2.5 Pro** 模型。 |
| **超长上下文** | 支持 $1,000,000$ token（100 万）的超长上下文窗口。 |
| **慷慨额度** | 针对个人用户，提供**每分钟 60 次**、**每天 1,000 次**的免费调用额度。 |

### 二、安装与环境准备

#### 1\. 前置条件

  * **Node.js 版本**：要求 **Node.js 版本不低于 v18**。
      * **验证**：执行 `node -v`，确保版本 $\ge 18$。

#### 2\. 安装与启动

  * **安装命令**：`npm install -g @google/gemini-cli`
  * **启动命令**：`gemini`
  * **首次启动**：选择主题，并使用 **Google 账号**进行身份验证。

### 三、认证失败的解决方案（网络与环境配置）

#### 1\. 情况一：网络原因导致的认证失败

  * **临时解决（当前终端）**：
    1.  按 **ESC** 结束认证，按两次 **Ctrl + C** 退出 CLI。
    2.  在终端中执行代理软件提供的 `export` 代理命令。
    3.  重新启动 `gemini` 进行认证。
  * **全局生效（所有终端）**：
    1.  开启代理软件的**增强模式/TUN 模式**。
    2.  将上述 `export https_proxy= http_proxy= all_proxy=` 命令添加到您的系统配置文件中（如 **`~/.zshrc`** 或 **`~/.bashrc`**）。例如使用 `vim` 编辑对 `.zshrc` 文件进行编辑，然后添加 export 命令设置环境变量：  


        ```bash
        # 在当前终端环境中设置三个代理变量，让命令行（如 curl、pip、git、npm 等）通过代理访问网络。
        export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890

        # ===== 验证代理是否生效 =====
        # 打印出当前 HTTPS 代理的值，用于确认是否成功设置
        echo $https_proxy   # 输出示例: http://127.0.0.1:7890

        # 打印出当前 HTTP 代理的值，用于确认 HTTP 请求是否走代理
        echo $http_proxy    # 输出示例: http://127.0.0.1:7890

        # 打印出通用代理（SOCKS5）的值，用于确认所有协议的代理设置
        echo $all_proxy     # 输出示例: socks5://127.0.0.1:7890
        ```

        ```bash
        # 打开.zshrc文件
        vim ~/.zshrc

        # 在vim编辑器中添加环境变量并保存        
        export https_proxy= http_proxy= all_proxy=
        ```

这样设置后，你只是告诉系统：

- “今后终端程序（如 curl、git、pip、npm）发出请求时，请通过 127.0.0.1:7890 代理。”

- 但真正提供代理转发功能的，是 ClashX 的本地监听端口。
也就是说：

  - `.zshrc` 是静态配置代理地址；

  - ClashX 是动态提供代理通道。

**结论：没有 ClashX 监听 → 代理变量仍在 → 但网络请求无法连接。**

    3.  执行 `source [配置文件名]` ，如：
        ```bash
        source ~/.zshrc
        ```
        `source` 命令的作用是立即重新加载 `.zshrc` 文件中的配置。这样，在第 2 步中添加的 `export` 命令无需重启终端即可生效。


    4.  TUN 模式 是一种通过虚拟网卡让 Clash 接管系统所有网络流量 的模式。它的作用是：**让不支持代理的程序（比如某些游戏、命令行工具、系统服务）也能走 Clash 代理。**

#### 2\. 情况二：账号配置问题（需设置 Project ID）

  * **1️⃣临时解决（当前终端）**：

    1.  获取您的 Google Cloud **项目 ID**（Project ID）。
    2.  执行 `export` 命令设置环境变量：
        ```bash
        export GOOGLE_CLOUD_PROJECT="[您的 Project ID]" 

        # 举例
        export GOOGLE_CLOUD_PROJECT=gen-lang-client-0021838680
        ```
    3.  重新启动 `gemini` 进行认证。

  * **2️⃣全局生效（所有终端）**：

    1.  将上述 `export GOOGLE_CLOUD_PROJECT` 命令添加到您的系统配置文件中（如 **`~/.zshrc`** 或 **`~/.bashrc`**）。例如使用 `vim` 编辑对 `.zshrc` 文件进行编辑，然后添加 export 命令设置环境变量：  
        ```bash
        vim ~/.zshrc
        # 打开.zshrc文件
        
        export GOOGLE_CLOUD_PROJECT=gen-lang-client-0021838680
        # 在vim编辑器中添加环境变量并保存
        ```

    2.  执行 `source [配置文件名]` ，如：
        ```bash
        source ~/.zshrc
         ```
     - `source` 命令的作用是立即重新加载 `.zshrc` 文件中的配置。这样，在第 1 步中添加的 `export` 命令无需重启终端即可生效。
    
    3.  输入 `echo $GOOGLE_CLOUD_PROJECT` 验证 Project ID 是否已成功且全局地设置到环境变量中。
        ```bash
        echo $GOOGLE_CLOUD_PROJECT
        ```


      * `echo` 命令用于输出变量；
      * `$GOOGLE_CLOUD_PROJECT` 表示读取该环境变量的值。

    <!-- end list -->

    > **注意**：`.zshrc` 适用于 Zsh，`.bashrc` 适用于 Bash。
    > -  从 macOS Catalina (10.15) 版本开始，Apple 将默认的 Shell 从 Bash 切换到了 Zsh (Z Shell)
    > -  如果您使用的是 macOS 默认的终端设置，那么您的 Shell 就是 Zsh 。

### 四、Gemini CLI 的操作符与内置功能

| 提示                                                 | 说明                                                                    |
| -------------------------------------------------- | --------------------------------------------------------------------- |
| **1. Ask questions, edit files, or run commands.** | 你可以像聊天一样提问，也可以编辑文件、运行命令。                                              |
| **2. Be specific for the best results.**           | 问得越具体，AI 回答越准确。                                                       |
| **3. Create GEMINI.md files...**                   | 你可以在项目目录创建一个 `GEMINI.md` 文件，用来定义 Gemini 的角色、任务或上下文（类似 prompt preset）。 |
| **4. /help for more information.**                 | 输入 `/help` 可以查看所有命令和功能说明。                            |

---

* 直接在终端内运行 Gemini CLI，可能会在用户主目录（~） 中运行。建议在一个**项目文件夹**里运行（例如 ~/myproject/），这样：

#### 1) 快速入口与上下文

* `cd <path>`：切换到你要演示或操作的目标文件夹（示例：`cd ~/project/temp`）。
* Gemini CLI 启动后会以交互式 CUI 进入，会展示提示符并等待你输入以三种前缀开头的命令：`/`、`!`、`@`。

---

#### 2) 三种操作前缀（核心规则）

* `/`（斜线） — 调用 **内置命令 / 工具 / 插件**（即 Gemini 提供的高层功能）。适用于查询、文件操作、网页提取、工具列表等。
* `!`（感叹号） — 在本地**执行 Shell 命令**（临时进入 shell 模式，重复输入 `!` 可退出回到 Gemini）。
* `@`（at 符号） — **引用本地文件或外部资源**（把本地文件、路径或外链带入到当前会话上下文中，供模型读取或操作）。

---

#### 3) `/tools`：工具系统与说明

* `/clear`：清除屏幕 
* `/tools nodesc`：显示每个工具（不详细显示说明，如功能、参数、注意事项）。
* 常见工具范例：

  * 读取文件夹（列出目录、预览）
  * 读取文件（打开并显示文件内容）
  * 搜索文件（按关键字或正则）
  * 编辑文件（在内置编辑器或外部编辑器中打开）
  * 提取网页（抓取、解析并摘要）
  * Google Search（网络检索并结构化返回结果）
  * 文件格式转换 / 批处理工具等

---

#### 4) 示例操作（演示中出现过的典型工作流）

1. **批量改后缀（用 shell）**

   * 操作示例：在 `temp` 文件夹把图片后缀统一改为 `.png`
   * 在 Gemini 中输入（演示风格）：`!` → `for f in *.jpg; do mv "$f" "${f%.jpg}.png"; done` → `!`（退出 shell）
   * 注意：执行 shell 需要授权；操作前备份或先 `ls` 检查文件列表。

2. **合并多个 Excel（用 Python 脚本）**

   * 演示流程：

     1. 执行 `/tools` 或请求“合并文件”工具 → Gemini 生成临时 Python 脚本。
     2. 自动安装/检查依赖（例如 `pandas`, `openpyxl`）。
     3. 运行脚本、合并并写入目标文件（指定合并后文件名）。
     4. 删除临时脚本以保持目录整洁。
   * 优点：模型自动生成脚本并运行；注意查看合并后的表头对齐和编码问题（例如中文 Excel 可能存在编码或表格样式差异）。

3. **文本替换（编辑文本文件）**

   * 任务：把科幻小说中的主角名 `EN` 替换为 `杰克`。
   * 通常流程：使用 `/tools edit <file>` 或直接 `@<file>` 把文件加载到上下文，然后发出替换指令，或用 `sed`/Python 做变更并保存。
   * 建议：先做一次 `git` 提交或生成备份，再执行全局替换。

4. **图片识别（多模态能力）**

   * 将图像 `@image.jpg` 引入会话，运行 `/tools analyse_image`（或直接询问模型识别）。
   * 返回：物体识别、文字识别（OCR）、颜色、品牌标识等结构化信息。
   * 注意：识别结果并非完美；对品牌/文字建议二次校验。

5. **网页提取与定位（抓取 + 摘要 + 指定提取）**

   * `/tools fetch <url>` 或直接使用 “提取网页” 工具。
   * 功能：

     * 自动摘要整篇文章。
     * 按请求提取指定代码段或页面片段（例如 MCP server 的 JSON 配置）。
   * 建议：如果需要精确片段，给出明确的定位提示（例如“提取标题为 X 的代码段”或使用 CSS/XPath）。

---

#### 5) 搜索与信息整理：`google search` 工具
* `/clear` 作用：清空屏幕
* `/tools nodesc` 代表： “no descriptions” —— 不显示详细描述，只显示工具名
* 使用场景：快速抓取行业新闻、技术趋势、伦理讨论等。
* 输出通常包含：分类（例如趋势/技术/全球动态/社会伦理）、摘要与关键条目。
* 建议把搜索结果与来源链接（或引用信息）记录，便于后续核验与引用。

---

#### 6) 上下文管理：`/compress`、`/chat save`、`/chat list`、`/chat resume`

* **问题**：连续多轮对话会把上下文堆满，超过模型最大上下文窗口会丢失早期信息。
* **`/compress`**：

  * 用途：把当前会话上下文做“压缩（摘要/归档）”，减少 token 占用，但保留语义要点。
  * 效果：显著降低 token 占用（例如示例从 4048 → 302）。
  * 使用场景：长篇写作、多轮协作、大量插图/数据的会话。
* **会话存储与恢复**：

  * `/chat save <tag>`：把当前“绘画/对话”保存为一个可恢复的记录（标签可自定义，示例：`article`、`code`）。
  * `/chat list`：列出已保存的会话/标签。
  * `/chat resume <tag>`：恢复之前保存的会话，继续编辑或生成。
* 建议：对重要草稿或长期项目定期保存并打上语义化标签，便于切换和协作。

---

#### 7) Memory（文件加入上下文）

* `/memory show`：查看当前 memory（默认会把 `GEMINI.md` 等文件加入上下文）。
* `/memory refresh`：把 `GEMINI.md` 或指定文件内容刷新进模型上下文（例如编程规范、风格指南、项目约定）。
* 用法场景：项目级别的编码规范、注释规则、前端风格、部署约定等，确保每次生成代码都遵守团队规则。
* 建议：把关键规范写入 `GEMINI.md` 并定期 refresh；避免在 memory 中放置敏感凭证或私密信息。

---

#### 8) MCP（Macro / Modular Control Plugins）与自动化浏览器

* MCP 是演示中用于把第三方自动化工具（如 Playwright）接入 Gemini 的机制（通过在本地主目录下的 `.gemini/settings.json` 或类似配置文件中添加 JSON 配置）。
* 配置流程（示例）：

  1. 在远端或文档中复制某个 MCP 的 JSON 配置（例如 Playwright 的配置）。
  2. 编辑 `~/.gemini/settings.json`，将该 JSON 插入到 MCP 配置段。
  3. 重新启动 Gemini CLI 并执行 `/mcp` 或 `/mcp desc` 来查看可用 MCP。
* 使用示例（自动化浏览器操作）：

  * 指令：使用 Playwright MCP 搜索某项目 → 打开 GitHub 项目 → 点 Star → 截图并保存到 `Downloads`。
  * 输出：执行记录（操作日志）与保存的截图路径。
* 注意事项：

  * MCP 执行浏览器操作可能需要系统上安装浏览器二进制或相应依赖。
  * 自动化行为可能触发网站反爬策略或需要登录态；谨慎使用并遵守服务条款。

---

#### 9) 编程/开发流程演示（与 VS Code 集成）

* 在 VS Code 终端里启动 Gemini CLI 以便边写代码边调用模型能力（生成/修复/解释代码）。
* 常见工作流：

  1. 在 `GEMINI.md` 写入团队编程规范（环境、风格、注释规则、前端选型等）。
  2. `/memory refresh` 将规范载入模型上下文。
  3. 发起代码生成请求（例如生成一个拼写单词练习 app）。
  4. 启动、测试、发现问题（例如拼写错误时无提示）。
  5. 请求 model 修复 bug → 重新部署 → 验证（演示中增加了“错误提示/抖动效果”）。
* 建议：为生成的服务保留快速回滚机制（如版本控制、Docker 镜像、虚拟环境快照）。

---

#### 10) 其他常用命令与信息

* `about`：查看 CLI 版本信息。
* `bug`：提交使用中遇到的问题或日志（便于修复）。
* `clear`：清屏。
* `dos`：打开说明文档（或 `help`）。
* `editor`：设置或切换外部编辑器（如使用 `code` 打开文件）。
* `privacy`：隐私设置（检查是否把本地文件或数据上传到云端）。
* `quit` 或 `Ctrl+C` ×2：退出。

---

#### 11) 权限与安全提醒

* **授权提示**：CLI 在执行可能影响本地文件系统或运行 shell 时会提示授权，请审慎授权。
* **敏感数据**：不要把 API keys、私密凭证、个人敏感信息放入公开会话或 memory 文件中。若需要模型访问凭证，优先使用短期凭证/环境变量并在用后撤销。
* **MCP 自动化**：自动化浏览器或远程仓库操作可能包含登录信息与操作风险，务必在受控环境（dev）测试并在生产环境加以限制。

---

#### 12) 常见问题与排错建议

* **生成脚本不能运行**：检查依赖安装情况、Python 版本、虚拟环境（建议使用 venv/conda）。
* **文件合并后列数/编码错乱**：检查每个 Excel 的表头是否一致、是否存在隐藏样式或合并单元格；导出为 CSV 再合并通常更稳妥。
* **OCR/识别不准确**：提供更高分辨率图片或裁切关键区域；对 OCR 输出使用后处理（正则/黑名单词典）。
* **MCP 无法运行 Playwright**：确认系统已安装 Playwright 及浏览器二进制，并确保 headless 模式与权限配置正确。
* **上下文超限**：使用 `/compress` 做摘要压缩，或 `/chat save` 把会话归档，避免超出 token 限制。

---

#### 13) 推荐最佳实践（快速清单）

1. 对重要文件操作先做备份或使用 Git 记录变更。
2. 把项目规范写入 `GEMINI.md`，并在生成前 `/memory refresh`。
3. 对自动执行的 shell/脚本授权前，先 `cat`（预览）脚本内容。
4. 使用 `/compress` 管理长会话；使用 `/chat save <tag>` 做版本化草稿。
5. 对外网抓取与自动化操作遵守目标站的使用条款与 robots 协议。
6. 遇到多语言或编码问题，优先转成 UTF-8 / CSV 格式进行处理。

---

#### 14) 结语（一句话回顾）

Gemini CLI（CUI）结合内置工具、shell 执行与可配置的 MCP 插件，能把日常文件处理、网页提取、多模态识别与自动化浏览器操作串成高效流水线。合理运用 `/tools`、`/compress`、`/memory` 与 MCP 配置，可以把重复劳动自动化并保持项目规范与可回溯性。

---



