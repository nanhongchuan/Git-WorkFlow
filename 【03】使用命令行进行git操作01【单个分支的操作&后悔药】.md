# Git 知识点总结（完整版）

## 1. Git 基础操作

* **查看版本**

  ```bash
  git --version
  ```
* **克隆仓库**

  ```bash
  git clone <repo-url>
  ```
* **查看状态**

  ```bash
  git status
  ```
* **添加文件到暂存区**

  ```bash
  git add <file>
  git add .   # 添加所有修改
  ```
* **提交修改**

  ```bash
  git commit -m "message"
  git commit -am "message"   # 修改的文件直接添加+提交
  ```
* **推送到远端**

  ```bash
  git push
  ```
* **拉取更新**

  ```bash
  git pull             # fetch + merge
  
  git pull --rebase    # fetch + rebase（推荐）

  git fetch --prune（修剪）
  # 远端分支被删除后，这个命令会获取远程最新信息，自动删除本地跟踪的已删除远程分支

  git remote prune origin 
  # 远端分支被删除后，这个命令可以自动删除本地跟踪的远程分支引用，清理本地已不存在的远程分支
  ```

* **远端重命名**
  ```bash
  # 更新远程仓库 URL 到新的地址
  git remote set-url origin https://github.com/<用户名>/<仓库名>.git
  ```

> **三种 `git push` 的对比**

| 命令                     | 含义                                            | 适用场景                                               | 是否需要指定分支     |
| ---------------------- | --------------------------------------------- | -------------------------------------------------- | ------------ |
| `git push`             | 将当前分支推送到默认远程仓库的同名分支                           | 已经设置了远程仓库和默认分支的情况（例如执行过 `git push -u origin main`） | 否            |
| `git push origin`      | 将当前分支推送到远程仓库 `origin` 中与当前分支同名的分支             | 当你只想指定远程仓库而不写分支名时                                  | 否（自动匹配当前分支名） |
| `git push origin main` | 明确指定将本地 `main` 分支推送到远程仓库 `origin` 的 `main` 分支 | 最常用、最安全的推送方式，适合首次推送或多分支项目                          | 是            |


> **三种 `git push`、`git push origin`、`git push origin main` 是否都正确**

| 命令                     | 是否语法正确 | 是否总能执行成功             | 依赖条件                  |
| ---------------------- | ------ | -------------------- | --------------------- |
| `git push`             | ✅ 正确   | ❌ 不一定                | 必须已设置默认上游分支（upstream） |
| `git push origin`      | ✅ 正确   | ⚠️ 取决于当前分支是否已存在于远程仓库 | 当前分支名需与远程同名           |
| `git push origin main` | ✅ 正确   | ✅ 最稳定、最通用            | 无需额外配置                |

---

## 2. 暂存区与文件操作

* **从暂存区移除文件**（不删除工作区的修改，相当于"撤销" `git add` 操作）

  ```bash
  git restore --staged <file>
  ```

* **把本地仓库的最新提交，恢复到工作区，丢弃工作区修改**
（HEAD 就是本地仓库的最新提交）

  ```bash
  git restore <file>
  ```

  > **两者表现不同的时刻，就是当文件处于 “已修改，但未暂存” 的状态时：**
  >- 想丢弃修改时： 您使用 `git restore <file>`（不带 `--staged`）。它会丢弃您的代码。
  >- 不想做任何事时： 您使用 `git restore --staged <file>`（带 --staged）。它不会影响工作区，由于文件本来就未暂存，它对暂存区的影响也无法被看到。


* **删除文件**

  ```bash
  git rm <file>
  ```
* **移动/重命名文件**

  ```bash
  git mv oldname newname
  ```

---

## 3. 合并与 Rebase

* `git pull = git fetch + git merge`

  * 会生成额外的 **merge commit (D)**
* `git pull --rebase`

  * 把你的提交“接到”远端最新提交后面，保持历史线性。

设置默认 rebase：

```bash
git config --global pull.rebase true
```

---

## 4. 查看历史

* **查看提交记录**

  ```bash
  git log
  ```


* **常用退出方法**
  - **q**  
  在 `git log` 打开的界面（`less`）中按 `q`，立即退出并返回 shell。（首选）

  - **Ctrl+C**  
  强制中断当前进程，适用在 `q` 无效或卡住时的应急手段。

   - **Ctrl+Z**  
  将 pager 挂起到后台（shell 提示符会回来），可用 `fg` 恢复；不推荐作为常规退出方式，只作临时挂起。
  

* **查看某次提交详情**

  ```bash
  git show <commit-id>
  ```

---

## 5. Git 的“后悔药”

### 1）Discard（丢弃修改，也叫rollback）

* 单个文件（**把本地仓库的最新提交，恢复到工作区，丢弃工作区修改**）：

  ```bash
  git restore <file>
  ```
* 所有文件：

  ```bash
  git reset --hard
  ```

### 2）Reset（重置到历史提交）最常用：

```bash
git reset --mixed <commit-id>
```

⚠️ 若已推送远端 → 需要 `git push -f`（危险，不推荐在公共分支）。

### 3）Revert（安全撤销）

```bash
git revert <commit-id>
```

生成反向提交，抵消历史修改。多人协作推荐。

### 4）Amend（修改最后一次提交）

```bash
git commit --amend
```

* 只能改最新提交
* 若已推送远端 → 需要强推（⚠️ 不要在公共分支使用）

---

## 6. 总结

* **merge** → 会产生额外提交，历史复杂
* **rebase** → 保持线性历史，推荐
* **restore --staged <单文件>** → 把文件从暂存区移回工作区（相当于"撤销" `git add` 操作）
* **四大“后悔药”：Discard、Reset、Revert、Amend**

---

 | Git操作  | Git 命令                           | 使用场景                          | 注意事项                                                                 |
|----------|------------------------------------|-----------------------------------|--------------------------------------------------------------------------|
| discard（丢弃）  | `git restore <文件名>` （单个文件）<br>`git reset --hard` （所有文件） | 工作区的修改还未 commit             | 舍弃掉工作区修改的文件                                                    |
| reset    | `git reset <commit ID>`            | 还原到某个 commit 的状态，舍弃之后的 commit | 如果 reset 已经推送远端的 commit，会造成强制推送，集成分支禁止强推                       |
| revert   | `git revert <commit ID>`           | 使用一个新的提交抵消掉某次 commit 的修改 |                                                                          |
| amend    | `git commit --amend`               | 只能修改最新的一次 commit           | 如果 amend 已经推送远端 commit，会造成强制推送，集成分支禁止强推                         |
